---
layout: post
title: "API JWT Authentication"
excerpt: "Authenticate like Google"
tags: [api, jwt, programming]
image:
# feature: pic brown wood apple logo 1900x500.jpg
  feature: https://cloud.githubusercontent.com/assets/300046/14622035/740efa5c-0584-11e6-9a41-db5b03eaff85.jpg
  credit: Green Coffee Lover
  creditlink: http://www.greencoffeelover.com/wp-content/uploads/2015/03/7.jpg
comments: true
---
<i>{{ page.excerpt }}</i>
<hr />

{% include _toc.html %}

<a target="_blank" href="https://wilsonmar.github.io/awt-jwt/">https://wilsonmar.github.io/awt-jwt</a>

This tutorial examines how the JWT (Java Web Token) authentication scheme works,
in a hands-on, step-by-step approach, with PROTIPs and NOTEs along the way.

BTW, JWT is pronounced as "jot".

We begin by <a href="#ManualDemo">
manually using Google's URL Shortener service</a> 
because Google was an early adopter of JWT for all their APIs.

We then look at <a href="#Diagram">my diagram of what happened behind the scenes</a>
to generate a JWT token based on Google API keys.


<a name="ManualDemo"></a>

## Manual User Interface #

As an introduction to how Google’s URL Shortener service works, 
let’s look at the human user interface which web services replace.

1.	Invoke a Google Chrome browser. If you do not have one installed, install it from
    <a target="_blank" href="http://google.com/chrome">http://google.com/chrome</a>

2.	Open an internet browser window to Google's URL Shortening service for individual Google users: 

    <a target="_blank" href="http://goo.gl/">http://goo.gl</a>

3.	Login using my Google account credentials.
    URLs shortened previous under your account should show up on the page:

    <amp-img width="650" height="379" alt="api-jwt-google-url-shortener-2016-06-30-650x379-63.jpg" 
    src="https://cloud.githubusercontent.com/assets/300046/16565704/501e5a3c-41cc-11e6-8b1a-337f58e886cc.jpg"></amp-img>

4.	Type or paste a URL in the text box and click the blue <strong>Shorten URL</strong> button. 

    Google takes the long URL pasted in the form and creates a SHORT URL from it.

5.	Use your mouse to highlight a goo.gl SHORT URL value to your Windows clipboard.

6.	Alt-click on a SHORT URL (in blue) to copy the URL link.

    You are taken to the URL.

The lower-left corner of
the diagram below illustrates what happened behind the scenes.

<a name="MyDiagram"></a>

## Diagram # 

<amp-img width="650" height="431" alt="api-jwt-diagram-20160704-650x431-81.jpg" 
    src="https://cloud.githubusercontent.com/assets/300046/16565917/d9d60fa8-41cd-11e6-8e23-0732ba803f57.jpg">
    </amp-img>

Looking at the bottom left of the diagram (shown in red), 
we obtain a shortened URL in a JSON response to
submitting a long URL to shorten. 

The previous section describes this action on the goo.gl website.
But we are examining this so we can do it on our own client instead.

Either way, JavaScript in the client makes a call to the API end-point within the 
<a target="_blank" href="https://support.google.com/cloud/answer/3465889?hl=en&ref_topic=3340599">
Google Cloud Platform</a>:

    https://www.googleapis.com/urlshortener/v1/url 

The client makes the call after placing the URL to shorten in the <strong>body</strong> of the call
along with a <strong>AccessToken</strong> that the client obtained from another end-point:

    https://accounts.google.com/o/oauth2/token

The call to that was made by providing a <strong>JWT Assertion</strong> string obtained from
a call to a utility JWT library running on the client, providing credentials obtained
from Google based on the Google account which signed in (represented at the upper left). 

The gray area on the right side describes the internal processing typically done by the 
utility JWT library loaded on the client.
Other established libraries (such as OpenSSL) are called
to perform the complex math needed to sign signatures required by JWT.
This tutorial will later dive into the 
internal workings of these libraries. 

But first we need to look into obtaining inputs to those libraries from the
<a target="_blank" href="https://developers.google.com/console/help/?csw=1#generatingoauth2
"> Google Cloud Platform Console</a>.

The client making the call needs to have three pieces of information in order to make the call:

1. Why the <strong>password</strong> still needs to be provided is a mystery to me because it 
   is always "notasecret" (not a secret) because secrecy now depends on cryptography
   provided by the next two items:

2. The service email for a specific project looks like an email:

    <tt>123456789012@developer.gserviceaccount.com</tt>

3. The service email is the basis for generating the 
   <strong>.p12 file fingerprint</strong>.   

So let's look at this process next.

## Google API Console #

This is done to provide an example for the day when you'll use your own 
<strong>API management platform</strong> instead of this example.

0. Use an internet browser to go to the Google Developers Console at 
   <a target="_blank" href="https://console.developers.google.com/">
   https://console.developers.google.com/</a>

0. Sign-in with a company account or your own personal account.

    PROTIP: For testing production applications and their APIs, 
    testers normally obtain credentials from Security or DevOps personnel who 
    create separate company Google accounts which they then specify for Google to create Service accounts.

   The most popular APIs (among all Google users) is presented:
   <amp-img width="650" height="448" alt="api-google-popular-20160704-650x448-83.jpg"
    src="https://cloud.githubusercontent.com/assets/300046/16567212/30ae36ba-41d9-11e6-8675-ed6c73156281.jpg">
    </amp-img>

0. First time visitors are asked to create a new project. Click on Create Project…. 

0. Google suggests a Project ID.

   PROTIP: Specify a version number after each project name.

0. Create a project from the Project Dashboard.

0. Type "shorten" in the gray search field.

0. Select "URL Shortener" when it appears.
