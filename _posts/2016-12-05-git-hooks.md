---
layout: post
title: "Git Hooks"
excerpt: "One commit and you're hooked"
shorturl: "https://git.io/v18ml"
modified:
tags: []
image:
# feature: pic blue black stars spin 1900x500.jpg
  feature: https://cloud.githubusercontent.com/assets/300046/14621973/fe6e21a6-0583-11e6-9a94-a969a51759b6.jpg
  credit: Jeremy Thomas
  creditlink: https://www.flickr.com/photos/132218932@N03/page2
comments: true
---
<i>{{ page.excerpt }}</i>
<hr />

{% include _toc.html %}

Here is a tutorial on how to make Git on a local machine
run a script automatically in response to git commands.

## How Git Hooks work

Every Git repository is created with a hooks folder.
Git looks into the `.git/hooks` folder for scripts when events occur.

PROTIP: In your GitHub repository, create a "hooks" folder containing script files 
that a new repo setup script copies into the `.git/hooks` folder.   

0. Navigate into any Git repository you want to automate.

   `cd .git/hooks`

   Each Git repository folder is created with a set of sample automation files.

   <pre>
<a target="_blank" href="https://github.com/git/git/blob/master/templates/hooks--applypatch-msg.sample">applypatch-msg.sample</a>
<a target="_blank" href="https://github.com/git/git/blob/master/templates/hooks--commit-msg.sample">commit-msg.sample</a>
<a target="_blank" href="https://github.com/git/git/blob/master/templates/hooks--post-update.sample">post-update.sample</a>
<a target="_blank" href="https://github.com/git/git/blob/master/templates/hooks--pre-applypatch.sample">pre-applypatch.sample</a>
<a target="_blank" href="https://github.com/git/git/blob/master/templates/hooks--pre-commit.sample">pre-commit.sample</a>
<a target="_blank" href="https://github.com/git/git/blob/master/templates/hooks--pre-push.sample">pre-push.sample</a>
<a target="_blank" href="https://github.com/git/git/blob/master/templates/hooks--pre-rebase.sample">pre-rebase.sample</a>
<a target="_blank" href="https://github.com/git/git/blob/master/templates/hooks--pre-receive.sample">pre-receive.sample</a>
<a target="_blank" href="https://github.com/git/git/blob/master/templates/hooks--prepare-commit-msg.sample">prepare-commit-msg.sample</a>
<a target="_blank" href="https://github.com/git/git/blob/master/templates/hooks--update.sample">update.sample</a>
   </pre>

   These files have a weird ".sample" in the file name so that it won't run.
   Git automatically runs files renamed with no file extension,
   such as "pre-commit". 

0. PROTIP: You may delete these sample files 
   because I've added links to each file listed above to 
   the source of the files at:

   <a target="_blank" href="https://github.com/git/git/tree/master/templates">
   https://github.com/git/git/tree/master/templates</a>

   ### Hooks by Event
   
   There are two types of hooks: client and server.

   On the client, upon `git commit`, the hooks are executed in this order:

   0. pre-commit (to run unit tests, look for console messages, etc.)
   0. prepare-commit-msg
   0. commit-msg (send email)
   0. post-commit
   <br /><br />

   * pre-rebase is run before Git executes `git rebase`.
   * applypatch-msg is run before Git executes `git patch`.
   <br /><br />

   On the server:

   0. pre-receive
   0. update
   0. post-receive (send email)
   <br /><br />


Before we get into manual instllation steps,
you need to know that there are automated options available.


## IntelliJ IDE Automation

<img align="right" alt="git intellij before commit 302x418-87kb" src="https://cloud.githubusercontent.com/assets/300046/20950204/8c6d379a-bbdb-11e6-9e31-58dc370be2de.png">

IntelliJ IDEA from Jetbrains, the free Community Edition, provides check-boxes to activate
Git hooks.

To see this dialog, ???

To get there within IntelliJ, let's use a sample project that already has
<strong>.idea</strong> folder containing files that define configurations for IntelliJ.

<a target="_blank" href="https://www.jetbrains.com/help/idea/2016.3/new-project-wizard.html">
IntelliJ has a project wizard to start from scratch on various languages</a>.

But Andrew Krug's Java example also has integration with testing utilities at:

   <a target="_blank" href="https://github.com/lazycoderio/Basic-Selenium-Java">
   https://github.com/lazycoderio/Basic-Selenium-Java</a>

0. Fork it in GitHub to your own account.
0. Clone it on your local machine:

   <pre>
   git clone https://github.com/<em>your_userid</em>/Basic-Selenium-Java
   cd Basic-Selenium-Java
   </pre>

0. Use Finder to look at the repo.

   The `basic-selenium-java.iml` file.

0. Install internet browsers used by running the shell script:

   `chmod +x mac_install_browsers.sh && ./mac_install_browsers.sh`

   Installed are browser add-ins for testing (with cask being used for GUI apps).
   Links to websites have been added:

   * brew install geckodriver
   * brew cask install firefox
   * brew install chromedriver
   * brew cask install google-chrome
   * brew install <a target="_blank" href="http://phantomjs.org/">
   phantomjs</a> (a "headless" browser)
   * Safari doesn't need to be installed because it comes with Apple Macs.

0. Use Finder to look at the <strong>pom.xml</strong> file
   specifying Java stuff to be downloaded:

   * org.seleniumhq.selenium
   * org.testng
   <br /><br />

   Maven plug-ins:

   * maven-surefire-plugin from http://maven.apache.org/components/surefire/maven-surefire-plugin/
   to execute tests. https://www.youtube.com/watch?v=R2ok6mKU0TI

   * <a target="_blank" href="http://www.jacoco.org/">
   jacoco-maven-plugin (http://www.jacoco.org/)</a> for determines code coverage.
   (It was written for running in Eclipse, but IntelliJ uses it too.)

   * coveralls-maven-plugin from https://github.com/trautonen/coveralls-maven-plugin
   to track code coverage over time
   
0. Look at the configuration files:

   codecov.yml ???

   mac-only.xml ???

   sonar-project.properties

   .travis.yml for using the Travis on-line service ???

0. Run the repo's installation script implementing the <strong>pom.xml</strong> file
   specifying Java stuff to be downloaded:

   <pre>mvn install</pre>

TODO: Andrew?

   ### pre-rebase test

0. Use a text editor to create in the hooks folder a "pre-rebase" containing
   this text described in YouTube video
   <a target="_blank" href="https://www.youtube.com/watch?v=RG26-Iozg70">
   Lifeâ€™s better with Git hooks - Grumpy Gits</a>
   [17:58] Nov 16, 2015 by Deepank Vora.

   <pre>
#!/bin/sh
echo "Custom rebasing message."
exit 1
   </pre>

   (Unlike Windows, Linux defines file handling 
   in the first line inside the file).

   PROTIP: Non-zero finish aborts the commit.

0. Enable the new script:

   <pre><strong>
   chmod +x pre-rebase
   </strong></pre>

   This would avoid messages such as:

   <pre>
-bash: ./pre-rebase: No such file or directory
   </pre>

0. Run the new script to make sure it works:

   <pre><strong>
   ./pre-rebase
   </strong></pre>

0. Open another Terminal shell window to the working directory of the repo
   to run the `git rebase master` command.

   You should see the custom message.

   QUESTION: If instead you see:

   <pre>
Current branch master is up to date.
   </pre>


   ### View pre-commit.sample

0. Use a text editor   Set to always open .sample files with a text editor.

   `#!/bin/sh` at the top of the file means that it's a Bash shell script.

   (Author Junio C Hamano is the primary developer of Git, now works at Google.)


<hr />

## Scrpts

   Git will run any script that can run on the command line:

   * Bash shell
   * Ruby
   * Python
   * Groovy
   * <a href="#PowerShell">PowerShell</a>

   <pre>
git ls-files -z | rsync --files-from - --copy-links -av0 . user@server.com:/var/www/project
   </pre>

   rsync uses ssh 

<a name="PowerShell"></a>

## PowerShell script


To have Git run a PowerShell script on pre-commit, 
<a target="_blank" href="http://stackoverflow.com/questions/5629261/running-powershell-scripts-as-git-hooks">try</a>
to create a shell script 

   <pre>
#!/bin/sh
# pre-commit (no file extension)
c:/Windows/System32/WindowsPowerShell/v1.0/powershell.exe \
-ExecutionPolicy RemoteSigned -Command .\.git\hooks\pre-commit.ps1
   </pre>

To test, put this `pre-commit.ps1` script in the folder:


## Resources

https://www.atlassian.com/git/tutorials/git-hooks/local-hooks

http://toroid.org/ams/git-website-howto

https://www.digitalocean.com/community/tutorials/how-to-use-git-hooks-to-automate-development-and-deployment-tasks

<a target="_blank" href="https://www.youtube.com/watch?v=8-JL6NOTZOw">
   023 Introduction to Git Hooks</a>
   by Dan Gitschooldude

<a target="_blank" href="https://www.youtube.com/watch?v=O0ODPxC9AJU">
   gated-commit with git pre-commit</a>
   [12:41] by fullstack

<a target="_blank" href="http://www.kernel.org/pub/software/scm/git/docs/githooks.html">
   Git hooks man page</a>

<a target="_blank" href="https://www.youtube.com/watch?v=MF72e-12dxE&t=10s">
   Andrew Burgess for Tuts</a>
   [7:28] June 28, 2012 describes run of mocha test processed by a Bash script.


## More on DevOps #

This is one of a series on DevOps:

{% include devops_links.html %}
