---
layout: post
title: "Git Hooks"
excerpt: "One commit and you're hooked"
shorturl: "https://git.io/v18ml"
modified:
tags: []
image:
# feature: pic blue black stars spin 1900x500.jpg
  feature: https://cloud.githubusercontent.com/assets/300046/14621973/fe6e21a6-0583-11e6-9a94-a969a51759b6.jpg
  credit: Jeremy Thomas
  creditlink: https://www.flickr.com/photos/132218932@N03/page2
comments: true
---
<i>{{ page.excerpt }}</i>
<hr />

{% include _toc.html %}

Here is a tutorial on how to make Git on a local machine
run a script automatically in response to git commands.

0. Navigate into any Git repository you want to automate.

   `cd .git/hooks`

   PROTIP: Each Git repository folder is created with a set of sample automation files.
   There are two types of hooks: client and server.
   listed alphabetically here:

   <pre>
<a target="_blank" href="https://github.com/git/git/blob/master/templates/hooks--applypatch-msg.sample">applypatch-msg.sample</a>
<a target="_blank" href="https://github.com/git/git/blob/master/templates/hooks--commit-msg.sample">commit-msg.sample</a>
<a target="_blank" href="https://github.com/git/git/blob/master/templates/hooks--post-update.sample">post-update.sample</a>
<a target="_blank" href="https://github.com/git/git/blob/master/templates/hooks--pre-applypatch.sample">pre-applypatch.sample</a>
<a target="_blank" href="https://github.com/git/git/blob/master/templates/hooks--pre-commit.sample">pre-commit.sample</a>
<a target="_blank" href="https://github.com/git/git/blob/master/templates/hooks--pre-push.sample">pre-push.sample</a>
<a target="_blank" href="https://github.com/git/git/blob/master/templates/hooks--pre-rebase.sample">pre-rebase.sample</a>
<a target="_blank" href="https://github.com/git/git/blob/master/templates/hooks--pre-receive.sample">pre-receive.sample</a>
<a target="_blank" href="https://github.com/git/git/blob/master/templates/hooks--prepare-commit-msg.sample">prepare-commit-msg.sample</a>
<a target="_blank" href="https://github.com/git/git/blob/master/templates/hooks--update.sample">update.sample</a>
   </pre>

   These files have a weird ".sample" in the file name so that it won't run.
   Git automatically runs files renamed with no file extension,
   such as "pre-commit". 

0. PROTIP: You may delete these sample files 
   because I've added links to each file listed above to 
   the source of the files at:

   https://github.com/git/git/tree/master/templates


   ### pre-rebase test

0. Use a text editor to create in the hooks folder a "pre-rebase" containing
   this text described in YouTube video
   <a target="_blank" href="https://www.youtube.com/watch?v=RG26-Iozg70">
   Lifeâ€™s better with Git hooks - Grumpy Gits</a>
   [17:58] Nov 16, 2015 by Deepank Vora.

   <pre>
#!/bin/sh
echo "Custom rebasing message."
exit 1
   </pre>

   (Unlike Windows, Linux defines file handling 
   in the first line inside the file).

   PROTIP: Non-zero finish aborts the commit.

0. Enable the new script:

   <pre><strong>
   chmod +x pre-rebase
   </strong></pre>

   This would avoid messages such as:

   <pre>
-bash: ./pre-rebase: No such file or directory
   </pre>

0. Run the new script to make sure it works:

   <pre><strong>
   ./pre-rebase
   </strong></pre>

0. Open another Terminal shell window to the working directory of the repo
   to run the `git rebase master` command.

   You should see the custom message.

   QUESTION: If instead you see:

   <pre>
Current branch master is up to date.
   </pre>


   ### View pre-commit.sample

0. Use a text editor   Set to always open .sample files with a text editor.

   `#!/bin/sh` at the top of the file means that it's a Bash shell script.

   (Author Junio C Hamano is the primary developer of Git, now works at Google.)

0. 

   ### pre-commit

   Upon git commit, the hooks are executed in this order:

   0. pre-commit (to run unit tests, look for console messages)
   0. prepare-commit-msg
   0. commit-msg (send email)
   0. post-commit

   Server hooks

   0. pre-receive
   0. update
   0. post-receive (send email)

<hr />

## Scrpts

   Git will run any script that can run on the command line:

   * Bash shell
   * Ruby
   * Python
   * Groovy
   * <a href="#PowerShell">PowerShell</a>

   <pre>
git ls-files -z | rsync --files-from - --copy-links -av0 . user@server.com:/var/www/project
   </pre>

   rsync uses ssh 

<a name="PowerShell"></a>

## PowerShell script

From <a target="_blank" href="http://stackoverflow.com/questions/5629261/running-powershell-scripts-as-git-hooks">
   PowerShell</a>

   <pre>
c:/Windows/System32/WindowsPowerShell/v1.0/powershell.exe \
-ExecutionPolicy RemoteSigned -Command .\.git\hooks\pre-commit.ps1
   </pre>


## Resources

https://www.atlassian.com/git/tutorials/git-hooks/local-hooks

http://toroid.org/ams/git-website-howto

https://www.digitalocean.com/community/tutorials/how-to-use-git-hooks-to-automate-development-and-deployment-tasks

<a target="_blank" href="https://www.youtube.com/watch?v=8-JL6NOTZOw">
   023 Introduction to Git Hooks</a>
   by Dan Gitschooldude

<a target="_blank" href="https://www.youtube.com/watch?v=O0ODPxC9AJU">
   gated-commit with git pre-commit</a>
   [12:41] by fullstack

<a target="_blank" href="http://www.kernel.org/pub/software/scm/git/docs/githooks.html">
   Git hooks man page</a>

<a target="_blank" href="https://www.youtube.com/watch?v=MF72e-12dxE&t=10s">
   Andrew Burgess for Tuts</a>
   [7:28] June 28, 2012 describes run of mocha test processed by a Bash script.


## More on DevOps #

This is one of a series on DevOps:

{% include devops_links.html %}
